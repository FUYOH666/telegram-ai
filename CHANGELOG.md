# Changelog

All notable changes to this project will be documented in this file.

## [0.4.0] - 2025-11-05

### Added

- **RAG система для базы знаний компании** - комплексная система поиска релевантной информации
  - Модуль `rag.py` для управления базой знаний компании
  - Автоматическая загрузка документации из директории `knowledge_base/` при старте
  - Семантический поиск релевантной информации перед генерацией ответа
  - Интеграция с VectorMemory (ChromaDB) для векторного поиска
  - Поддержка текстовых файлов (.txt, .md) с автоматическим разбиением на чанки
  - Автоматическое добавление найденной информации в контекст для более точных ответов

- **База знаний из сайта и GitHub** - автоматизированное создание базы знаний
  - Скрипт `extract_website_content.py` для парсинга сайта scanovich.ai
  - Скрипт `extract_github_projects.py` для анализа всех GitHub репозиториев через GitHub CLI
  - Скрипт `build_knowledge_base.py` для валидации и сборки базы знаний
  - Структурированная база знаний с 38+ документами:
    - Информация о компании (5 файлов)
    - Описания проектов (19 файлов из 17 репозиториев)
    - Технологии и компетенции (6 файлов)
    - Примеры решений по индустриям (5 файлов)
    - Возможности и универсальность (3 файла)

- **Конфигурация RAG системы** - настройки для управления базой знаний
  - `rag.enabled` - включить/выключить RAG систему
  - `rag.knowledge_base_path` - путь к директории с документацией
  - `rag.max_results` - максимальное количество результатов поиска (по умолчанию: 5)
  - `rag.min_score` - минимальный score для включения результата (по умолчанию: 0.7)
  - `rag.auto_load_on_startup` - автоматическая загрузка при старте

### Changed

- Обновлена конфигурация RAG системы в `config.yaml`:
  - RAG включен по умолчанию (`enabled: true`)
  - Увеличен `max_results` до 5 для лучшего покрытия информации
  - Путь к базе знаний: `./knowledge_base`

- Расширена документация README.md:
  - Добавлен раздел "RAG система для базы знаний компании"
  - Добавлен раздел "Обновление базы знаний"
  - Обновлена структура проекта с новыми директориями

- Улучшен скрипт `build_knowledge_base.py`:
  - Добавлена валидация категории `capabilities`
  - Исключение `README.md` из подсчета документов для точной статистики
  - Улучшено описание структуры базы знаний в README.md
  - Добавлены инструкции по использованию скрипта

### Technical

- Новый модуль: `src/telegram_ai/rag.py`
- Новые скрипты: `scripts/extract_website_content.py`, `scripts/extract_github_projects.py`, `scripts/build_knowledge_base.py`
- Обновлены: `ai_client.py` (поддержка RAG), `client.py` (инициализация RAG), `config.py` (RAGConfig)
- База знаний использует отдельную коллекцию ChromaDB (`rag_knowledge_base`)

## [0.3.0] - 2025-11-05

### Added

- **Автоматическое извлечение слотов через LLM** - `SlotExtractor` для автоматического извлечения информации из сообщений
  - Извлечение бюджета, сроков, целей проекта, контактной информации
  - Поддержка слотов для Sales AI и Real Estate интентов
  - Fallback на ручные вопросы если LLM не нашел слот
  - Сокращение количества вопросов на 30-50%

- **Summarization для длинных контекстов** - автоматическое создание резюме старых сообщений
  - Таблица `ConversationSummary` для хранения summary
  - Автоматическое создание summary при превышении `context_window`
  - Включение summary в начало контекста для сохранения важной информации
  - Настраиваемый порог через `memory.summary_threshold`

- **ML-based Intent Classification с confidence scores** - улучшенная классификация намерений
  - LLM-based классификация с оценкой уверенности (0.0-1.0)
  - Fallback на keyword-based при низкой уверенности (<0.7)
  - Улучшение точности классификации на 15-25%
  - Логирование confidence scores для анализа

- **Векторный поиск в истории диалогов** - семантический поиск релевантных сообщений
  - Интеграция ChromaDB для векторного хранилища
  - Векторизация сообщений при сохранении
  - Автоматический поиск релевантных сообщений из истории
  - Комбинирование временного и семантического поиска в контексте
  - Поддержка embeddings через LLM API или встроенные embeddings ChromaDB

- **Роадмап улучшений** - `rm.md` с планом развития проекта
- **Анализ похожих проектов** - `SIMILAR_PROJECTS_ANALYSIS.md` с исследованием

### Changed

- Обновлена конфигурация с новыми параметрами:
  - `slot_extraction.enabled` - включить автоматическое извлечение слотов
  - `intent_classifier.use_llm` - использовать LLM для классификации
  - `intent_classifier.confidence_threshold` - порог уверенности
  - `memory.auto_summarize` - автоматическая summarization
  - `memory.summary_threshold` - порог для создания summary
  - `memory.vector_search_enabled` - включить векторный поиск
  - `memory.vector_db_path` - путь к ChromaDB

- Обновлена структура проекта с новыми модулями
- Расширены тесты для нового функционала

### Technical

- Добавлена зависимость `chromadb>=0.4.0`
- Новые модули: `slot_extractor.py`, `vector_memory.py`
- Обновлены: `memory.py`, `intent_classifier.py`, `client.py`, `config.py`
- Все тесты проходят (92/92)

## [0.2.1] - 2025-11-05

### Added

- **Скрипт очистки данных пользователя** - `clear_user_data.py` для полной очистки истории разговоров
  - Удаление всех сообщений, разговоров, контекста и rate limit записей для конкретного пользователя
  - Опция `--list` для просмотра всех пользователей в базе данных
  - Интерактивное подтверждение перед удалением данных

- **Метод очистки данных пользователя** - `Memory.delete_user_data()` для программной очистки
  - Удаление всех связанных данных пользователя из БД
  - Возвращает статистику удаленных записей

### Changed

- **Улучшена обработка китайского языка** - явное указание на упрощенный китайский (Simplified Chinese)
  - Обновлено название языка на "упрощенном китайском (Simplified Chinese)"
  - Добавлена специальная инструкция для китайского языка в системный промпт
  - Инструкция для китайского языка имеет максимальный приоритет (добавляется в начало промпта)
  - Явный запрет на использование английского, русского и традиционного китайского
  - Добавлена fallback проверка для гарантии наличия инструкции

- **Обновлен системный промпт** - добавлены правила для китайского языка
  - Явное указание на упрощенный китайский (简体中文)
  - Запрет на переключение на другие языки

### Fixed

- **Запрет на запрос изображений** - добавлено явное ограничение в системный промпт
  - Модель не обрабатывает изображения, поэтому AI больше не будет просить скриншоты или фото
  - Предложение альтернатив: описание словами или другой канал связи

## [0.2.0] - 2025-01-XX

### Added

- **Интеграция Web Search MCP** - автоматический поиск актуальной информации в интернете
  - Поддержка MCP Web Search сервера для получения актуальных данных
  - Автоматическое определение необходимости поиска по ключевым словам
  - Лимиты на количество запросов за диалог (настраиваемые)
  - Форматирование результатов поиска для включения в контекст AI

- **Улучшенный системный промпт** - более живое и естественное общение
  - Усиленная роль "Александр, основатель Scanovich.ai" с конкретным опытом
  - Правила эмпатии и активного слушания
  - Консультативный подход в продажах (доверенный партнёр)
  - Больше примеров живого общения (few-shot)

- **Динамические параметры генерации** - тонкая настройка по этапам продаж
  - Автоматическая настройка temperature, max_tokens, top_p, frequency_penalty, presence_penalty
  - Разные параметры для каждого этапа скрипта продаж
  - Оптимизация для Small Talk (более креативно) и Sales (более детерминированно)

- **Улучшенные модификаторы этапов** - более естественные реакции
  - Примеры естественных реакций для каждого этапа
  - Усиленные правила длины ответов
  - Правила использования имени пользователя

- **Улучшенные промпты для слотов** - открытые вопросы вместо допроса
  - Более естественные формулировки
  - Убраны "допросные" тона

- **Улучшенный классификатор намерений** - расширенные ключевые слова и веса
  - Расширенные списки ключевых слов для Sales AI и Real Estate
  - Веса для важных слов (более важные слова = больше вес)
  - Улучшенная логика сохранения контекста
  - Логирование результатов классификации для анализа

- **Поддержка имени пользователя** - извлечение и использование имени из Telegram API
  - Автоматическое сохранение имени пользователя в контексте
  - Использование имени в промптах (периодически, не в каждом сообщении)

### Changed

- Системный промпт полностью переработан для более живого общения
- Модификаторы этапов обновлены с примерами и правилами консультативного подхода
- Промпты для запроса слотов сделаны более открытыми и естественными
- Параметры генерации теперь динамически настраиваются по этапам

### Technical

- Новый модуль `web_search.py` для интеграции с MCP Web Search
- Расширен `ai_client.py` для поддержки дополнительных параметров генерации
- Обновлен `config.py` с конфигурацией Web Search
- Добавлены тесты для Web Search интеграции

## [0.1.0] - 2025-11-05

### Added

- Базовая функциональность Telegram AI-ассистента для личного аккаунта
- Интеграция с локальным AI-сервером (OpenAI-compatible API)
- Память и контекст диалогов через SQLite
- Интеграция с Google Calendar (опционально)
- Конфигурация через YAML и ENV переменные
- Автоматические ответы на сообщения в личных чатах
- Команды для управления календарем (`/calendar`, `/events`, `/create_event`)

### Technical

- Python 3.12
- Telethon для работы с личным аккаунтом Telegram
- SQLAlchemy для работы с БД
- Pydantic Settings для конфигурации
- Tenacity для ретраев
- httpx для HTTP запросов

