# Changelog

All notable changes to this project will be documented in this file.

## [0.2.1] - 2025-11-05

### Added

- **Скрипт очистки данных пользователя** - `clear_user_data.py` для полной очистки истории разговоров
  - Удаление всех сообщений, разговоров, контекста и rate limit записей для конкретного пользователя
  - Опция `--list` для просмотра всех пользователей в базе данных
  - Интерактивное подтверждение перед удалением данных

- **Метод очистки данных пользователя** - `Memory.delete_user_data()` для программной очистки
  - Удаление всех связанных данных пользователя из БД
  - Возвращает статистику удаленных записей

### Changed

- **Улучшена обработка китайского языка** - явное указание на упрощенный китайский (Simplified Chinese)
  - Обновлено название языка на "упрощенном китайском (Simplified Chinese)"
  - Добавлена специальная инструкция для китайского языка в системный промпт
  - Инструкция для китайского языка имеет максимальный приоритет (добавляется в начало промпта)
  - Явный запрет на использование английского, русского и традиционного китайского
  - Добавлена fallback проверка для гарантии наличия инструкции

- **Обновлен системный промпт** - добавлены правила для китайского языка
  - Явное указание на упрощенный китайский (简体中文)
  - Запрет на переключение на другие языки

### Fixed

- **Запрет на запрос изображений** - добавлено явное ограничение в системный промпт
  - Модель не обрабатывает изображения, поэтому AI больше не будет просить скриншоты или фото
  - Предложение альтернатив: описание словами или другой канал связи

## [0.2.0] - 2025-01-XX

### Added

- **Интеграция Web Search MCP** - автоматический поиск актуальной информации в интернете
  - Поддержка MCP Web Search сервера для получения актуальных данных
  - Автоматическое определение необходимости поиска по ключевым словам
  - Лимиты на количество запросов за диалог (настраиваемые)
  - Форматирование результатов поиска для включения в контекст AI

- **Улучшенный системный промпт** - более живое и естественное общение
  - Усиленная роль "Александр, основатель Scanovich.ai" с конкретным опытом
  - Правила эмпатии и активного слушания
  - Консультативный подход в продажах (доверенный партнёр)
  - Больше примеров живого общения (few-shot)

- **Динамические параметры генерации** - тонкая настройка по этапам продаж
  - Автоматическая настройка temperature, max_tokens, top_p, frequency_penalty, presence_penalty
  - Разные параметры для каждого этапа скрипта продаж
  - Оптимизация для Small Talk (более креативно) и Sales (более детерминированно)

- **Улучшенные модификаторы этапов** - более естественные реакции
  - Примеры естественных реакций для каждого этапа
  - Усиленные правила длины ответов
  - Правила использования имени пользователя

- **Улучшенные промпты для слотов** - открытые вопросы вместо допроса
  - Более естественные формулировки
  - Убраны "допросные" тона

- **Улучшенный классификатор намерений** - расширенные ключевые слова и веса
  - Расширенные списки ключевых слов для Sales AI и Real Estate
  - Веса для важных слов (более важные слова = больше вес)
  - Улучшенная логика сохранения контекста
  - Логирование результатов классификации для анализа

- **Поддержка имени пользователя** - извлечение и использование имени из Telegram API
  - Автоматическое сохранение имени пользователя в контексте
  - Использование имени в промптах (периодически, не в каждом сообщении)

### Changed

- Системный промпт полностью переработан для более живого общения
- Модификаторы этапов обновлены с примерами и правилами консультативного подхода
- Промпты для запроса слотов сделаны более открытыми и естественными
- Параметры генерации теперь динамически настраиваются по этапам

### Technical

- Новый модуль `web_search.py` для интеграции с MCP Web Search
- Расширен `ai_client.py` для поддержки дополнительных параметров генерации
- Обновлен `config.py` с конфигурацией Web Search
- Добавлены тесты для Web Search интеграции

## [0.1.0] - 2025-11-05

### Added

- Базовая функциональность Telegram AI-ассистента для личного аккаунта
- Интеграция с локальным AI-сервером (OpenAI-compatible API)
- Память и контекст диалогов через SQLite
- Интеграция с Google Calendar (опционально)
- Конфигурация через YAML и ENV переменные
- Автоматические ответы на сообщения в личных чатах
- Команды для управления календарем (`/calendar`, `/events`, `/create_event`)

### Technical

- Python 3.12
- Telethon для работы с личным аккаунтом Telegram
- SQLAlchemy для работы с БД
- Pydantic Settings для конфигурации
- Tenacity для ретраев
- httpx для HTTP запросов

